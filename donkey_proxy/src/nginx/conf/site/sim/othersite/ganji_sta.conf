server {
  listen  80;
  listen 443 ssl;
  server_name stavip.ganji.com sta.ganji.com ~^sta[1-8]?\.ganji\.com sta.ganjistatic1.com stacdn201.ganjistatic1.com trajs.ganjistatic1.com stavip.ganjistatic1.com sta1.ganjistatic2.com sta2.ganjistatic2.com stacdn.ganjistatic2.com;
  index index.php index.htm index.html;
  root /data/server/www/ganji/ganji_online/ganji_sta;

#location ~* ^.+.(css|js)$ {
# expires           6h;
# }

  error_page  404 /404.html;


 
 location / {
        if ($uri ~ "\.(css|js|jpg|jpeg|png|gif)$") {
		expires           7d;
        }
 		rewrite '^(.*).__(\d{1,20})__.(js|css|ico|gif|jpg|jpeg|png|swf|html?)$' /$1.$3 break;
}
 
location /att {
 	root /server/www/ganji/ganji_online/static;
        if ($uri ~ "\.(css|js|jpg|jpeg|png|gif)$") {
                expires           7d;
        }
 	rewrite '^(.*).__(\d{1,20})__.(js|css|ico|gif|jpg|jpeg|png|swf|html?)$' /$1.$3 break;
}
 
location /src/att {
 	root /server/www/ganji/ganji_online/static;
        if ($uri ~ "\.(css|js|jpg|jpeg|png|gif)$") {
                expires           7d;
        }
 	rewrite '^/src/att/(.*)$' /att/$1;
 	rewrite '^(.*).__(\d{1,20})__.(js|css|ico|gif|jpg|jpeg|png|swf|html?)$' /$1.$3 break;
}
 
location /html {
 	root /server/www/ganji/ganji_online/static;
        if ($uri ~ "\.(css|js)$") {
                expires           7d;
        }
 	rewrite '^(.*).__(\d{1,20})__.(js|css|ico|gif|jpg|jpeg|png|swf|html?)$' /$1.$3 break;
}
 
location /src/html {
	root /server/www/ganji/ganji_online/static;
        if ($uri ~ "\.(css|js|jpg|jpeg|png|gif)$") {
                expires           7d;
        }
 	rewrite '^/src/html/(.*)$' /html/$1;
 	rewrite '^(.*).__(\d{1,20})__.(js|css|ico|gif|jpg|jpeg|png|swf|html?)$' /$1.$3 break;
}

location  /css {
	root /data/server/www/ganji_v3/apps/media;
	if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
		expires      365d;   
		}
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
	rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /gmap {
	root /data/server/www/ganji_v3/apps/media;
	if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
		expires      365d;   
		}
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
	rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /images {
	root /data/server/www/ganji_v3/apps/media;
	if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
		expires      365d;   
		}
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
	rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /js {
	root /data/server/www/ganji_v3/apps/media;
	if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
		expires      365d;   
		}
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
	rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /swftool {
        root /data/server/www/ganji_v3/apps/media;
        if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
                expires      365d;
                } 
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
        rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /upload {
        root /data/server/www/ganji_v3/apps/media;
        if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
                expires      365d;
                }
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
        rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location  /upload3 {
        root /data/server/www/ganji_v3/apps/media;
        if ($uri ~ "\.(gif|jpg|jpeg|png|bmp|swf)?$") {
                expires      365d;
                } 
        if ($uri ~ "\.(css|js)?$") {
                expires           7d;
        }
        rewrite '^(.*).__(\d{10,12})__.(js|ico|gif|jpg|jpeg|png|css)$' /$1.$3 break;
}

location ~ '^/ng/(.*?)(\.__\d*__)(\..*)$' {
       expires 7d;
       alias /server/www/ganji/ganji_online/ng_sta/build/$1$3;
   }

   location ~ '^/ng/(.*)$' {
       expires -1;
       alias /server/www/ganji/ganji_online/ng_sta/build/$1;
   }


  location ~* .*\.php$ {
    fastcgi_pass  127.0.0.1:9000;
    fastcgi_index index.php;
    include fastcgi.conf;
  }


#start edit by yifan 20120222
location /nginx-status {
stub_status on;
access_log off;
allow 127.0.0.1;
deny all;
}
#end
  access_log  /data/nginx/logs/sta_access.log ;
  error_log /data/nginx/logs/sta_error.log;
#  access_log off;
}
